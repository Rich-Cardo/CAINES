{% include 'header.html' %}

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="alert alert-info">
      {{ messages[0] }}
    </div>
  {% endif %}
{% endwith %}

<form class="form-login m-auto" method="post" action="/agregar_cita" enctype="multipart/form-data"> 
 
 
    <!-- Esta linea de codigo sirve para saber primero si existe una cita o no hay una cita -->
    {% if cita %}
    {% if cita[3] == 'pendiente' %}

    <!-- Codigo para cuando sí haya una cita en proceso -->

        <h1 class="h3 mb-3 fw-normal text-center">Solicitud en proceso</h1>

        <p class="text-center">Ya posee una solicitud en proceso, por favor espere su aprobación.</p>

        <div class="row" style="margin-bottom: 10px;">

            <input id="txtID" value="{{representante.id}}" class="form-control col-8" type="hidden" name="txtID">
        </div>

        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Fecha</label>
            <input id="txtFecha" class="form-control col-8" type="date" name="txtFecha" required readonly>
        </div>


        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Cédula</label>
            <select class="form-select form-select-lg" id="cod_cedula" style="margin-right:14px">
                <option value="1">V</option>
                <option value="2">J</option>
                <option value="3">E</option>
            </select>
            <input id="txtCedula" class="form-control col-7" type="text" name="txtCedula" pattern="[0-9\s]+" title="Sólo se permiten números" value="{{representante.cedula}}" required readonly>
        </div>
        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Nombre</label>
            <input id="txtNombre" value="{{representante.nombre}}" class="form-control col-8" type="text" name="txtNombre" pattern="[a-zA-Z\s]+" title="Sólo se permiten caracteres" required readonly>
        </div>
        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Apellido</label>
            <input id="txtApellido" value="{{representante.apellido}}" class="form-control col-8" type="text" name="txtApellido" required readonly>
        </div>
        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Dirección</label>
            <input id="txtDireccion" value="{{representante.direccion}}" class="form-control col-8" type="text" name="txtDireccion" pattern="[a-zA-Z\s]+" readonly title="Sólo se permiten caracteres">
        </div>
        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Teléfono</label>
            <!-- <select class="form-select form-select-lg" id="cod_numero" style="margin-right:6px" name="cod_numero">
                <option value="0412">0412</option>
                <option value="0414">0414</option>
                <option value="0416">0416</option>
                <option value="0424">0424</option>
                <option value="0426">0426</option>
            </select> -->
            <input  id="txtTelefono" value="{{representante.telefono}}" class="form-control col-8" type="text" name="txtTelefono" pattern="[0-9\s]+" title="Sólo se permiten números" required readonly>
        </div>
        <div class="row" style="margin-bottom: 10px;">
            <label for="txtCorreo" class="col-3">Correo</label>
            <input id="txtCorreo" value="{{representante.correo}}" class="form-control col-8" type="email" name="txtCorreo" placeholder="correo@ejemplo.com" readonly>
        </div>
        

        <a class="btn button-login w-100" href="/eliminar_cita/{{cita[0]}}" onclick="return confirm('¿Desea borrar el registro?')" style="background-color:brown; margin-bottom:6px; margin-top:15px;">Anular Cita</a>
        <a class="btn button-login w-100" style="background-color: green;" href="/menu">Cancelar</a>

    </form>
    {% endif %}


    {% else %}
        <!-- Codigo para cuando NO haya una cita registrada -->

        <h1 class="h3 mb-3 fw-normal text-center">Agendar Cita</h1>

        <div class="row" style="margin-bottom: 10px;">

            <input id="txtID" value="{{representante.id}}" class="form-control col-8" type="hidden" name="txtID">
        </div>

        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Fecha</label>
            <input id="txtFecha" class="form-control col-8" type="date" name="txtFecha" required readonly>
        </div>


        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Cédula</label>
            <select class="form-select form-select-lg" id="cod_cedula" style="margin-right:14px">
                <option value="1">V</option>
                <option value="2">J</option>
                <option value="3">E</option>
            </select>
            <input id="txtCedula" class="form-control col-7" type="text" name="txtCedula" pattern="[0-9\s]+" title="Sólo se permiten números" value="{{representante.cedula}}" required readonly>
        </div>
        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Nombre</label>
            <input id="txtNombre" value="{{representante.nombre}}" class="form-control col-8" type="text" name="txtNombre" pattern="[a-zA-Z\s]+" title="Sólo se permiten caracteres" required readonly>
        </div>
        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Apellido</label>
            <input id="txtApellido" value="{{representante.apellido}}" class="form-control col-8" type="text" name="txtApellido" required readonly>
        </div>
        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Dirección</label>
            <input id="txtDireccion" value="{{representante.direccion}}" class="form-control col-8" type="text" name="txtDireccion" pattern="[a-zA-Z\s]+" readonly title="Sólo se permiten caracteres">
        </div>
        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Teléfono</label>
            <!-- <select class="form-select form-select-lg" id="cod_numero" style="margin-right:6px" name="cod_numero">
                <option value="0412">0412</option>
                <option value="0414">0414</option>
                <option value="0416">0416</option>
                <option value="0424">0424</option>
                <option value="0426">0426</option>
            </select> -->
            <input  id="txtTelefono" value="{{representante.telefono}}" class="form-control col-8" type="text" name="txtTelefono" pattern="[0-9\s]+" title="Sólo se permiten números" required readonly>
        </div>
        <div class="row" style="margin-bottom: 10px;">
            <label for="txtCorreo" class="col-3">Correo</label>
            <input id="txtCorreo" value="{{representante.correo}}" class="form-control col-8" type="email" name="txtCorreo" placeholder="correo@ejemplo.com" readonly>
        </div>

        

        <button type="submit" class="btn button-login w-100" style="background-color:green; margin-bottom:6px; margin-top:15px;">Solicitar Cita</button>
        <a class="btn button-login w-100" style="background-color: brown;" href="/menu">Cancelar</a> 
    

    {% endif %}


    <!-- Esta linea de codigo sirve para saber primero si existe una cita o no hay una cita -->
    {% if cita %}
    {% if cita[3] == 'aprobado' %}

    <!-- Codigo para cuando la cita este APROBADA por el Director -->

        <h1 class="h3 mb-3 fw-normal text-center">¡Su cita fue aprobada!</h1>

        <p class="text-center">Por favor, diríjase al Centro de Atención en la fecha y hora indicados a continuación: </p>

        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Fecha</label>
            <input id="txtFecha" class="form-control col-8" type="date" name="txtFecha" required readonly>
        </div>

        <div class="row" style="margin-bottom: 10px;">
            <label for="floatingInput" class="col-3">Hora</label>
            <input id="txtFecha" class="form-control col-8" type="text" name="txtHora" value="{{cita[5]}}" required readonly>
        </div>

        <a class="btn button-login w-100" href="/menu" style="background-color:green; margin-bottom:6px; margin-top:15px;">Volver</a>
        <a class="btn button-login w-100" style="background-color: brown;" href="/eliminar_cita/{{cita[0]}}" onclick="return confirm('¿Desea borrar el registro?')">Anular Cita</a>

    </form>
    {% endif %}
    {% endif %}





    

</form>

<script>

    // Codigo para que el input fecha salga con la fecha actual
    var campoFecha = document.getElementById("txtFecha");

    // Obtener la fecha actual en el formato YYYY-MM-DD
    var fechaActual = new Date().toISOString().slice(0, 10);

    // Asignar la fecha actual al campo de fecha
    campoFecha.value = fechaActual;

        // Codigo para que el input fecha salga con la fecha actual 
        var campoFecha = document.getElementById("txtFecha");
    
    // //ATENCION: Se realizó un cambio para obtener la fecha en formato DD-MM-YYYY. 
    // // Obtener la fecha actual en el formato YYYY-MM-DD 
    // var fechaActual = new Date().toISOString().slice(0, 10); 

    // // Convertir la fecha actual al formato DD-MM-YYYY
    // var fechaActualFormateada = fechaActual.split("-").reverse().join("-"); 

    // // Asignar la fecha actual formateada al campo de fecha 
    // campoFecha.value = fechaActualFormateada; 

</script>

{% include 'footer.html' %}
